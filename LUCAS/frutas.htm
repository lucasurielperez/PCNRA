const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 400;
canvas.height = 600;

class Fruit {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.radius = 20;
        this.vy = 0; // Velocidad vertical
        this.gravity = 0.5; // Gravedad
        this.bounceCount = 0; // Contador de rebotes
        this.maxBounces = 5; // Máximo de rebotes
        this.isSettled = false; // Indica si la fruta está quieta
    }

    update() {
        if (!this.isSettled) {
            this.vy += this.gravity; // Aplicar gravedad
            this.y += this.vy; // Actualizar posición vertical

            // Detectar impacto con el suelo
            if (this.y + this.radius > canvas.height) {
                this.y = canvas.height - this.radius; // Corregir posición al suelo
                this.bounce();
            }
        }
    }

    bounce() {
        if (this.bounceCount < this.maxBounces) {
            // Rebote: subir la mitad de la altura del canvas
            const bounceHeight = canvas.height / 2;
            this.vy = -Math.sqrt(2 * this.gravity * bounceHeight); // Velocidad para alcanzar la mitad del canvas
            this.bounceCount++;
        } else {
            this.vy = 0; // Detener la fruta
            this.isSettled = true;
        }
    }

    draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = 'red';
        ctx.fill();
        ctx.closePath();
    }
}

let fruit = new Fruit(canvas.width / 2, 0); // Primera fruta en el centro superior
let fruits = [fruit]; // Lista para manejar múltiples frutas más adelante

function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpiar canvas

    // Actualizar y dibujar la fruta actual
    fruit.update();
    fruit.draw();

    // Si la fruta está quieta, lanzar una nueva
    if (fruit.isSettled && fruits.length === 1) {
        fruit = new Fruit(canvas.width / 2, 0); // Nueva fruta en el mismo lugar
        fruits.push(fruit); // Añadir a la lista (para colisiones futuras)
    }

    requestAnimationFrame(gameLoop);
}

gameLoop();