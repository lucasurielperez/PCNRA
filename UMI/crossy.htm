<!DOCTYPE html>
<html>
<head>
    <title>Crossy Road Clone</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
        }
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #70c5ce;
            overflow: hidden;
        }
        #player {
            position: absolute;
            width: 50px;
            height: 50px;
            transition: all 0.1s;
        }
        .road {
            position: absolute;
            width: 100%;
            height: 50px;
        }
        #controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 10;
        }
        .control-btn {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            user-select: none;
            touch-action: manipulation;
            transition: background 0.2s; /* Transición suave */
        }
        .control-btn:active {
            background: rgba(200, 200, 200, 0.9); /* Cambio al tocar */
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <img id="player" src="images/player.png">
    </div>
    <div id="controls">
        <div class="control-btn" data-direction="up">↑</div>
        <div class="control-btn" data-direction="left">←</div>
        <div class="control-btn" data-direction="right">→</div>
        <div class="control-btn" data-direction="down">↓</div>
    </div>

    <script>
        const gameContainer = document.getElementById('gameContainer');
        let player = document.getElementById('player'); // No lo eliminamos aún
        const containerWidth = window.innerWidth;
        const containerHeight = window.innerHeight;

        // Manejo del jugador con fallback
        function setupPlayer() {
            const img = new Image();
            img.src = 'images/player.png';
            
            img.onload = function() {
                player = document.getElementById('player');
                updatePlayerPosition();
            };
            
            img.onerror = function() {
                const canvasPlayer = document.createElement('canvas');
                canvasPlayer.id = 'player';
                canvasPlayer.width = 50;
                canvasPlayer.height = 50;
                const ctx = canvasPlayer.getContext('2d');
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(10, 10, 30, 30);
                gameContainer.appendChild(canvasPlayer);
                const oldPlayer = document.getElementById('player');
                if (oldPlayer) oldPlayer.remove();
                player = canvasPlayer; // Actualizamos la referencia
                updatePlayerPosition();
            };
        }

        // Configuración inicial del jugador
        let playerPos = {
            x: containerWidth / 2 - 25,
            y: containerHeight - 100
        };

        // Generar carreteras
        const roads = [];
        const roadHeight = 50;
        const totalRoads = Math.ceil(containerHeight / roadHeight) + 1;

        function createRoad(y, type) {
            let road;
            const img = new Image();
            img.src = `images/road${type}.png`;
            
            img.onerror = function() {
                road = document.createElement('canvas');
                road.width = containerWidth;
                road.height = 50;
                const ctx = road.getContext('2d');
                ctx.fillStyle = type === 0 ? '#808080' : '#90EE90';
                ctx.fillRect(0, 0, containerWidth, 50);
                road.className = 'road';
                road.style.top = `${y}px`;
                gameContainer.appendChild(road);
            };
            
            img.onload = function() {
                road = img;
                road.className = 'road';
                road.style.top = `${y}px`;
                gameContainer.appendChild(road);
            };
            
            roads.push({ element: road, y: y, type: type });
        }

        for (let i = 0; i < totalRoads; i++) {
            const type = Math.floor(Math.random() * 2);
            createRoad(i * roadHeight, type);
        }

        // Actualizar posición del jugador
        function updatePlayerPosition() {
            if (player) {
                player.style.left = `${playerPos.x}px`;
                player.style.top = `${playerPos.y}px`;
            }
        }

        // Movimiento del jugador
        function movePlayer(direction) {
            const step = 50;
            switch(direction) {
                case 'up':
                    if (playerPos.y > 0) playerPos.y -= step;
                    break;
                case 'down':
                    if (playerPos.y < containerHeight - 50) playerPos.y += step;
                    break;
                case 'left':
                    if (playerPos.x > 0) playerPos.x -= step;
                    break;
                case 'right':
                    if (playerPos.x < containerWidth - 50) playerPos.x += step;
                    break;
            }
            updatePlayerPosition();
        }

        // Controles para teclado (PC)
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowUp': movePlayer('up'); break;
                case 'ArrowDown': movePlayer('down'); break;
                case 'ArrowLeft': movePlayer('left'); break;
                case 'ArrowRight': movePlayer('right'); break;
            }
        });

        // Controles táctiles (móvil)
        const buttons = document.querySelectorAll('.control-btn');
        buttons.forEach(button => {
            button.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const direction = button.getAttribute('data-direction');
                movePlayer(direction);
            });
            button.addEventListener('touchend', (e) => e.preventDefault());
            button.addEventListener('touchmove', (e) => e.preventDefault());
        });

        // Scroll del terreno
        function updateRoads() {
            roads.forEach(road => {
                road.y += 2;
                road.element.style.top = `${road.y}px`;
                
                if (road.y > containerHeight) {
                    road.y -= totalRoads * roadHeight;
                    road.type = Math.floor(Math.random() * 2);
                    if (road.element.tagName === 'CANVAS') {
                        const ctx = road.element.getContext('2d');
                        ctx.fillStyle = road.type === 0 ? '#808080' : '#90EE90';
                        ctx.fillRect(0, 0, containerWidth, 50);
                    } else {
                        road.element.src = `images/road${road.type}.png`;
                    }
                }
            });
            requestAnimationFrame(updateRoads);
        }

        // Iniciar el juego
        setupPlayer();
        requestAnimationFrame(updateRoads);
    </script>
</body>
</html>